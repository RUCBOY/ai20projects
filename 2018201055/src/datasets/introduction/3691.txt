Automation, particularly since the industrial revolution, has had a profound impact on the technological and economic evolution of human society. There are now very few areas of human activity which have not seen the introduction of significant automation in one form or another.1 It is, therefore, somewhat surprising that chemical synthesis (at least in the majority of academic research laboratories) is still performed using largely the same apparatus and labour intensive techniques developed when the discipline was still young. Whilst a number of very well engineered and robust automated chemical synthesis platforms are available commercially, and have obtained growing popularity in industrial research laboratories, their relatively high price often puts them beyond the reach of many academic research groups.
In a growing context of chemist-led technological innovation,2, (a), (a)(b), (a)(c) we have been interested in using open-source hardware and software technologies to develop alternative low-cost automation platforms for chemical synthesis.
In the last two decades or so, a number of significant developments have taken place which have made enabling technologies much more accessible to 'non experts'. In terms of coding, the advent of high-level scripting languages, like Python,3 have made it easier to write highly functional programs without the need to understand underlying low-level processes. A major attraction of Python is the availability of a vast array of libraries that provide specific functionality across a diverse range of application areas. These often act as wrappers around code written in computationally more efficient languages such as C/C++ or Fortran. In terms of electronic hardware, the growing availability of easy to program microcontrollers (such as Arduino,4 PICAXE5 and PyBoard/MicroPython6) as well as General-Purpose-Input-Output (GPIO) enabled single-board computers (such as the Raspberry Pi7 and BeagleBoard8) has enabled the ready interfacing of control systems with electronic machinery and components.9 In addition to the technologies themselves, the community-driven models of open innovation and applications that have evolved alongside them have also played a major role in their success and popularity.10
In our previous work,11 we carried out a series of acid catalysed silyl group deprotections using a homemade 3-axis autosampler and a series of motor actuated valves to select and load starting materials into a holding loop and to control the liquid flow through the system. In that case, whilst the selection of the starting materials was automated, the collection of reaction products into separate containers was not and switching between the collection vessels had to be performed manually.
In this manuscript we describe an improved automation system which selects and loads starting materials and also collects products into separate collection flasks.
Shown in Fig. 1 (top) is a simplified schematic representation of our previous system. Starting materials were taken from the autosampler and loaded into the holding loop by means of Syringe Pump 1 (the holding loop was not completely filled, thereby avoiding contamination of Syringe Pump 1). The common reagent was loaded into Syringe Pump 2 and, after switching of valves, the Piston Pump and Syringe Pump 2 would push the two solutions through the reaction/purification zone and product flow streams would emerge at the outlet to be collected in suitable vessels. As the autosampler was not also being used to collect products, the necessary flushing of the residual starting material (in the line between the autosampler and 3-Way Valve 2) into a waste channel could be left until after the reaction had completed (by moving Syringe Pump 1 back to its original starting position).Download : Download high-res image (499KB)Download : Download full-size imageFig. 1. Simplified schematic of our previous (top) and current (bottom) reaction systems.
For our updated autosampling/product-collection system, the flushing of the line to the autosampler could not be left until after the reaction had completed as the residual starting material would then end up in the product collection vessel. In order to incorporate this step in a way which minimised the amount of additional hardware required, we added an extra 3-Way Valve and a secondary Holding Loop (Fig. 1, bottom). This would allow Syringe Pump 1 to load the required starting material into Holding Loop 1 and then, after switching of 3-Way Valves 2 and 4 and moving of the autosampler needle to the waste position, to flush out the residual starting material (between the autosampler and 3-Way Valve 4) by moving back to its original position. After moving the autosampler needle to the correct collection vessel, the Piston Pump could then be used to push the starting material flow stream through the reaction system. The volume of Holding Loop 2 was chosen to be slightly higher than that of Holding Loop 1 in order to prevent unwanted premature mixing of the starting material with the common reagent stream (from Syringe Pump 2).
In order to demonstrate the operation of the system, we sought to carry out the flow chemical12 formation of a series of benzamides, 4, using benzoyl chloride, 1, as the common limiting reagent and a series of primary amines, 2, as the liquid-liquid extractable13 starting materials used in excess (Scheme 1). In order to facilitate rapid reaction in the flow system at room temperature, we also planned to use 2 equivalents of 4-dimethylaminopyridine (DMAP, 3) as the liquid-liquid extractable stoichiometric base due to its ability to also act as a nucleophilic catalyst.14 One of the key limitations of flow chemistry is that it is generally incompatible with reactions that form precipitates. As the most likely precipitate from the reactions in our solvent of choice (dichloromethane) would be the HCl salt of DMAP, we carried out preliminary solubility studies of this material (which was made by the addition of aqueous HCl to DMAP in THF solution).Download : Download high-res image (57KB)Download : Download full-size imageScheme 1. 
Unsurprisingly, the material was insoluble in neat dichloromethane at realistic concentrations. Acetonitrile was attempted as a cosolvent but this did not provide significant additional solubility. Methanol did prove to be a useful cosolvent and a 3:1 mixture of dichloromethane: methanol was found capable of dissolving DMAP-HCl at a concentration of at least 0.17 M. When reactions between dichloromethane solutions of benzoyl chloride (1) and methanolic solutions of excess benzylamine (2a) and DMAP (3) were attempted, although the reactions proceeded rapidly at room temperature, in the absence of precipitation and with all of the excess DMAP and amine being efficiently removed by extraction with aqueous HCl, the amide product 4a was accompanied by small amounts of methyl benzoate, indicating that methanol was competing as a nucleophile with the amine. In order to reduce the nucleophilicity whilst still providing the requisite polarity, isopropanol was investigated as an alternative, more sterically hindered cosolvent. Again, significant concentrations of DMAP hydrochloride could be obtained using isopropanol as a cosolvent with dichloromethane (e.g. greater than 0.13 M in 1:1 dichloromethane: isopropanol). Pleasingly, when we attempted the same formation of benzylbenzamide using this solvent mixture, the reaction proceeded rapidly at room temperature, again without any precipitation, and with no apparent formation of isopropyl benzoate as a side product.
With suitable reaction conditions in hand, our attention turned to the utilisation of the automation system to carry out a series of flow chemical benzamide formations (Scheme 2). A full schematic of the flow system is shown in Fig. 2.Download : Download high-res image (374KB)Download : Download full-size imageScheme 2. Results of automated flow chemical benzamide formations.Download : Download high-res image (511KB)Download : Download full-size imageFig. 2. Schematic of the flow system for the automated formation of benzamides.  Motor control from Raspberry Pi.  Control computer link to webcam and pump control. ― Flow line.
The main Python control script for the system ran on a laptop computer. This computer also communicated directly with Syringe Pumps 1 and 2 as well as Piston Pump 1 through USB-RS232 connections. In total, 8 stepper motors were required for mechanical actuation (4 x 3-Way-Valves, 1 x 2-Way Valve, 3 axes of the autosampler/product-collector). These were controlled indirectly through an intermediate Raspberry Pi single board computer. Connection between the laptop and the Raspberry pi was via a UART TTL-232R-3V3 cable. In our previous system, the Pololu A4988 stepper driver boards15 used for motor control were mounted on single breadboards. With an increased number of motors, it became more important to minimise the number of wires and contacts. For this reason, we used 2 RAMPS boards16 (each of which can accommodate up to 5 Pololu A4988 boards) which were connected directly to the Raspberry Pi. Although RAMPS boards are primarily designed as shields for Arduino compatible input-output interface layouts, this did provide significant improvements to the organisation of the wiring (see Supporting Information for further details).
Solutions of 10 amine starting materials 2a-j and DMAP 3 in isopropanol were placed in vials whose openings were covered with two layers of parafilm (which would allow the take-up needle to easily pass through but would prevent any premature evaporation of solvent). These were placed in a test tube rack which was positioned on the bed of the autosampler. As mentioned above, the autosampler was used to select the appropriate amine/DMAP solution and load it into Holding Loop 1 using Syringe Pump 1. A total of 5 mL of solvent was taken in by Syringe Pump 1. The total volume of the tubing line between the amine solution and 3-Way Valve 2 was 1 mL, so that only 4 mL would enter Holding Loop 1 and thus be available for reaction (the residual 1 mL would be flushed to waste). Holding Loop 1, which was 4.7 mL in volume, was therefore large enough to accommodate this quantity of amine/DMAP solution without the risk of contamination upstream of 3-Way Valve 1. After switching of 3-Way Valves 2 and 4, and moving the autosampler needle to the waste position, Syringe Pump 1 moved back to its original position, thereby pushing the starting material solution from Holding Loop 1 to Holding Loop 2 whilst at the same time flushing out the residual starting material downstream of 3-Way Valve 4. Once Syringe Pump 2 (which was preprimed with 5 mL benzoyl chloride solution) had taken in the appropriate quantity of benzoyl chloride solution (0.13 M in DCM, 3 mL) 3-Way Valve 3 was switched to allow the two streams to meet and react. As the acid chloride was the limiting and non-extractable reagent and the acid-extractable amine was being used in excess, it was important to make sure that the acid chloride solution was always accompanied by amine. As Holding Loop 2 was 6 mL in volume (to fully accommodate all of the amine solution), there was an approximately 1 mL volume of neat dichloromethane at the 'front' of Holding Loop 2 and 1 mL of neat dichloromethane at the 'tail' (as 5 mL of solvent were injected by Syringe Pump 1 to move the starting material between the two Holding Loops). Syringe Pump 2 began pumping the benzoyl chloride solution (for 6 min at a flow rate of 0.5 mL min−1) 3 min after Piston Pump 1 started pumping into the starting material stream (corresponding to 1.5 mL at 0.5 mL min−1, the flow rate of Piston Pump 1). This meant that there would be an approximately 0.5 mL ‘overlap’ of amine solution entering t-piece T-1 prior to the acid chloride solution and an approximately 0.5 mL ‘overlap’ after the acid chloride solution had ceased entering T-1. During the batch studies of cosolvent screening, we established that a 10 min reaction time was at least sufficient for complete reaction conversion at room temperature. A 10 mL reaction loop was therefore placed downstream of T-1 to provide the appropriate residence time. To maintain a constant 1 mL min−1 flow rate through the reaction loop, the flow rate of Piston Pump 1 was increased to 1 mL min−1 (from 0.5 mL min−1) once Syringe Pump 2 had ceased pumping. The reaction was quenched downstream of the reaction loop, at t-piece T-2, by the addition of an aqueous stream of 0.5 M phosphoric acid solution at 2.0 mL min−1. Phosphoric acid was chosen, rather than an alternative such as hydrochloric acid, as it is generally compatible with the types of stainless steel commonly used in HPLC pumps. The combined biphasic aqueous/organic stream was thoroughly mixed by passing through an active mixer that consisted of several small PTFE coated stirrer bars inside a glass omnifit column placed on a magnetic stirrer plate.17 Upon exiting the mixer, the flow stream entered the liquid-liquid separation vessel. The position of the liquid-liquid interface was monitored using a webcam in conjunction with an OpenCV hue filtering algorithm in the main Python control script.18 This was indirectly achieved by using a green plastic 'float' that had a density in between that of the aqueous and organic phases. When the position of the interface moved below a lower set bound, the 2-Way Valve would be opened so that the aqueous phase could leave the separation vessel through the upper outlet (the path of least resistance) causing the interface to rise. When the interface reached a set upper bound, the 2-Way Valve would close again, forcing the dense organic phase to leave through the lower outlet. Experimentation with plastic mixtures identified an approximately 2.9: 1 mixture of polyethyelene (from the plunger of a disposable syringe) and polyacetal (from a green Keck clip) as appropriate for a range of biphasic water-dichloromethane-isopropanol combinations. Despite the fact that isopropanol solutions were, for short bursts, injected into the flow stream in the absence of dichloromethane (which forms the dense organic phase), no adverse effects on the operation of the liquid-liquid extraction process were detected. The organic layer remained the most dense and the float remained at the liquid-liquid interface throughout the entire run. It is likely, due to dispersion effects, that the organic flow stream entering the liquid-liquid extraction stage retained a significant proportion of dichloromethane at all times.
From experimental runs using coloured dyes, it was determined that a flow time of 30 min for Piston Pump 1, after the acid chloride had been injected, would be sufficient to ensure that all product/reagent had cleared the system. During this time, product solutions were collected into 65 mL beakers, with approximately 38 mL of outlet solution being collected for each run. At the end of each reaction, a second flushing procedure was necessary to clear the remaining residual starting material from the tubing between 3-Way Valves 2 and 4. It should be pointed out that, during this final flushing step, and also during the filling of Holding Loop 1, the 2-Way Valve controlling the aqueous outlet was held in an open position as the lower organic outlet was closed off (at 3-Way Valve 4) during these stages. The total time for each run, including time taken to change the autosampler position, switch valves and flush at the end of the run, was about 60 min. A step-by-step graphical description of the flow sequence for the reaction runs is provided in the Supporting Information, which also includes the Python source code for the scripts running on the control computer and the Raspberry Pi.
At the end of the series of reactions, the benzamide products were isolated by removing the solvent under reduced pressure (using a rotary evaporator followed by further drying with a 2-stage rotary vane pump). As the agitation/mixing and separation stages of the liquid-liquid extraction process occur in different vessels, the lower organic layer did not contain any visible droplets of the aqueous phase. For this reason, it was not necessary to use a desiccant (e.g. magnesium sulfate), which would typically be required when using a separating funnel. Any dissolved water that may have been present was removed along with the solvent under vacuum. The results of the reactions are shown in Scheme 2. The products were obtained in high yield and with high levels of purity (as indicated by 1H and 13C NMR, spectra are provided in the Supporting Information section).
In conclusion, several open-source hardware and software technologies were used in the development of a low-cost automated synthesis platform. Whereas our previous system automated only the selection and loading of starting materials, the inclusion of an additional motor-actuated valve and holding loop also facilitated the automation of product collection. This was then used to effect the flow chemical synthesis of a series of benzamides. An inline computer-vision controlled liquid-liquid extraction stage, using aqueous phosphoric acid, effectively removed excess amine and DMAP from the reaction, affording the amide products in high yields and purities. We are currently working on expanding the functionality of the system and will report our findings in due course.
