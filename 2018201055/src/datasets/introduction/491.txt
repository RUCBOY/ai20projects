Density-functional theory (DFT) [1], [2] applied in chemistry, physics, and material science is the ground-state theory through which one can calculate the total energy and its first order derivatives (e.g. dipole moment and force). The response properties (e.g., polarizability, vibrational frequencies or phonon dispersions) related to the second and higher order derivatives of the total energy can be obtained within the same framework by means of density-functional perturbation theory (DFPT) [3], [4], [5] or the so-called coupled perturbed self-consistent field (CPSCF) method [6], [7], [8], [9], [10], [11] in the quantum chemistry community.
Recently, we have developed and implemented a real-space formalism for DFPT [12] in the all-electron, full-potential, numerical atomic orbitals based Fritz Haber Institute ab initio molecular simulations (FHI-aims) package, which allows us to take advantage of the inherent locality of the basis set to achieve a numerically favorable scaling. Such real-space DFPT has been applied in lattice dynamics calculations [12] and in computations of the polarizabilities, dielectric constants, harmonic as well as anharmonic Raman spectra [13], in which good computational accuracy, computational efficiency, and parallel scalability have been demonstrated.
In our previous scaling test [12], [13], it was found that, for large systems with more than 1,000 atoms, the computational cost for updating the response density matrix becomes dominant. It is because the dense matrix multiplication operations in this step scale as O(N3), and thereby, present a serious bottleneck to deal with large systems. It is desirable to make the computational time scale linearly, i.e. O(N), with the size of the system [14]. In order to achieve this goal, the Kohn’s nearsightedness principle [15] needs to be adopted. It says that, for a quantum mechanical system within an external potential, its local properties do not “see” a change of the external potential if this change is limited to a distant region. This fundamental principle is behind almost all linear scaling algorithms [16], [17], [17], [18], [19], [20], [21], which leads to the sparsity of the density matrix — a key to achieve the linear scaling. Using sparse zero-order density and Hamiltonian matrices, in 2002, Niklasson suggested a trace-correcting (TC2) approach to replace the traditional diagonalization step through a density matrix purification method [22]. Later in 2004, Niklasson and Challacombe proposed the density matrix perturbation theory (DMPT) [23] to extend the TC2 approach in calculating response density matrices. In contrast to the traditional density functional perturbation theory, where the first-order density matrix is calculated from dense eigenstate coefficients matrices, the DMPT approach only adopts sparse first-order Hamiltonian and density matrices, leading to the linear scaling of the calculations. Such DMPT approach can be further combined with the CPSCF cycles, and in this way, the response properties can be calculated self-consistently. This combination is called the TC2-CPSCF method throughout this paper.
The advantage of linear scaling in calculations can be significantly enhanced if the computations are performed in a massively parallel way. Currently, the parallelization of the TC2 method has been achieved in a few different ways, like using in-node parallelism via multithreading scheme within one node [24], [25], using MPI parallelization based on the distributed block compressed sparse row (DBCSR) library [26] in CP2K [27], or using the hybrid MPI+OpenMP parallelization scheme [28] for the coordinate (COO) data format [29]. For the TC2-CPSCF method, however, there are only serial implementations [30], [31] and no parallel implementation and scalability performance testing has been done yet.
In this work, we have implemented the sparse matrices-based TC2-CPSCF method in the FHI-aims package. We have also parallelized the code by using the MPI level distributed memory parallelization algorithm. The linear scaling and good parallel scalability have been achieved for the response density matrix calculation within DFPT. The linear scaling with system sizes up to several thousands of atoms and the scalability on tens of thousands of cores are demonstrated using various realistic systems.
The remainder of this paper is organized as follows. The fundamental theoretical framework is presented in Section 2. In Section 3, the implementation is validated by comparing the calculated analytical polarizabilities with results obtained from the traditional O(N3) approach. We also discuss the convergence behavior of the implementation, the scaling of the computational cost with the system sizes, and the parallel performance on a large number of cores. In Section 4, we summarize our main achievement and highlight the relevance of this work to the parallel implementation of other methods.
