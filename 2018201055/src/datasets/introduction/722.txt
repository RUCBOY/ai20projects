The domain name system (DNS) provides a fundamental service to Internet users, as it provides mappings from fully qualified domain names (FQDNs) to numerical IP addresses. These mappings are a necessary link that connects human users to the routing information of the Internet. Standards such as DNSsec and DNS over HTTPS (DoH) (Osterweil et al., 2007; Szalachowski and Perrig, 2017; Dickinson, 2020; Lian et al., 2013) have been developed for securing this protocol. However, DNSsec only provides trust in DNS information, and messages are not ciphered. With DoH, messages are ciphered, but its use remains anecdotal (Lu et al., 2019). Maintaining the DNS as it was 40 years ago renders it vulnerable to abuses and attacks (Klein and Pinkas, 2019; Zhao et al., 2007; Pearce et al., 2017) and provides internet service providers (ISPs) with requested DNS domains, which they can exploit to obtain data regarding the actions their clients perform using their Internet service. For example, an end-user who is browsing the Internet will request the DNS resolution of all the DNS domains of the visited web pages.
Most Internet traffic is ciphered (Torres et al., 2017) (for example, using secure web browsing with HTTPS). Therefore, deep packet inspection does not provide much information to ISPs. Some information can still be obtained from un-encrypted headers, for example the internet protocol address of the accessed servers, however, capturing and processing tens or hundreds of gigabits per second present in ISP trunks is highly costly or even unfeasible (Moreno et al., 2015). The DNS service becomes a weak point that can be exploited by ISPs to obtain as much information as possible about the browsing patterns of their subscribers. We have confirmed the existence of ISPs that utilize this type of practice. ISPs own the local DNS, which is configured by default for their subscribers by the DHCP (dynamic host configuration protocol). That local DNS is responsible for resolving all DNS requests sent by subscribers; therefore, it is the point at which the DNS responses can be easily modified by the ISP.
The TTL (time-to-live) field of DNS responses is used to realize scalability, as it enables the caching of FQDN information by an intermediate name server or user host, thereby preventing the host from needing to query constantly the authoritative name servers. This TTL controls the update frequency of the DNS records. Do not confuse this TTL field with the field of the same name in the IP header. Increasing TTL is being used by traffic control tools (Drako, 2013), and its use has been studied for additional applications in mobile environments (Wu et al., 2007), in order to reduce server load. Otherwise, decreasing TTL can be used by ISPs without the user's awareness to extract more information about browsing habits, as the user has accepted these conditions in the contract with his ISP. Reducing the TTL value of a DNS response does not substantially affect the Internet latency (Bhatti and Atkinson, 2011), and it does not significantly increase the load for DNS servers (Jung et al., 2002). This behaviour of ISPs has not been exposed in the literature before, and of course, ISPs do not expose publicly what they are doing and why. The only explanation for the modification of TTLs from ISPs that we have found is that it allows them to obtain many more samples of DNS requests from their subscribers. Changing the DNS settings to another DNS server in the client side is not a valid solution for preventing ISPs from collecting information by reducing the TTL of the DNS responses because ISPs can inspect DNS queries to third-party DNS servers and interfere with their responses (DNS transparent proxy). Therefore users are disabled from taking measures to prevent the ISP from compromising their privacy.
By reducing the TTL of DNS responses, ISPs are requiring the client to make more DNS requests, and these DNS request can be used by the ISP to identify, with higher temporal granularity, the sites that their subscribers are browsing. For example, for the domain booking.com (an important travel and reservations web site), the TTL is 86,400; hence, a DNS request would be conducted every 24 h. By modifying the TTL to 60 s, a DNS request will be conducted every minute, which enables ISPs to obtain a better web browsing profile of the user. It is well-know that ISPs are using DNS traffic to make this profiling and that they do not agree with migrating to secure DNS proposals that would block the activity (Ma et al., 2015). The manipulation of TTL can improve this profiling in a very significate way.
Although tools are available that can help advanced users identify DNS servers that manipulate DNS answers to prevent possible attacks (Trevisan et al., 2017), no practical and easy-to-use tool is available that enables regular Internet users to identify possible abuses that involve DNS manipulation. To satisfy this need, we developed a web tool, namely DNSPrivacyTester1, that can identify possible abuses that involve DNS manipulation not only from ISP DNS resolvers but also from any other resolver that might be changing the TTL values of DNS responses to attack users and violate their privacy. The results demonstrate that it is possible to identify DNS manipulation using the user web browser with high accuracy in less than 3 min and that ISPs are using this TTL manipulation, especially for mobile networks.
The main contributions of this paper are the following:
•We have identified a technique used by ISPs to get more information about the behaviour of their subscribers. To the best of our knowledge, this was not documented previously in the literature. This technique is based in the manipulation of the TTL field in DNS responses and it compromises user privacy.•We have presented a methodology to enable subscribers to identify when their ISPs are manipulating the DNS responses in such a manner that they could obtain high resolution browsing information. The procedure uses only response times from DNS queries.•We have developed a public web tool which implements the aforementioned methodology and we made the source code available.•We have carried out a measurement campaign to validate our proposal and analysed the impact on privacy of Internet users in terms of the amount of information an ISP can collect by using the manipulation of the TTL field in DNS responses.
The remainder of this paper is organized as follows: Section 2 describes the manipulation of DNS responses to compromise user privacy. In Section 3, we explain the system that is used to collect DNS resolution times from end users. Then, in Section 4, we discuss the identification of DNS manipulation using DNS resolution times. In Section 5, we describe our online tool that enables Internet users to check if their DNS has been manipulated and, therefore, if their privacy has been compromised. In Section 6, we discuss results that were obtained using our online tool. In Section 7, we briefly describe related work. Finally, in Section 8, we present the conclusions of this study.
